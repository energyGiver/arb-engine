# Arb Engine

CEX/PerpDEX ì•„ë¹„íŠ¸ë¼ì§€ ë´‡ - ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘, ê¸°íšŒ íƒì§€, ì‹œë®¬ë ˆì´ì…˜

## ê°œìš”

ë‹¨ì¼ ë¨¸ì‹ (ë©íƒ‘)ì—ì„œ ì´ˆë‹¨ìœ„ë¡œ ê±°ë˜ì†Œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³ , ì•„ë¹„íŠ¸ë¼ì§€ ê¸°íšŒë¥¼ íƒì§€í•˜ë©°, ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ ì „ëµì„ ê²€ì¦í•˜ëŠ” Python ê¸°ë°˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- **ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘**: ì´ˆë‹¨ìœ„ WebSocket ì—°ê²°ë¡œ ê°€ê²©, L5 orderbook, funding rate ìˆ˜ì§‘
- **ë©€í‹° ê±°ë˜ì†Œ ì§€ì›**:
  - CEX: Binance, Bybit, OKX
  - PerpDEX: Hyperliquid, Lighter
- **ì•„ë¹„íŠ¸ë¼ì§€ íƒì§€**: ìˆ˜ìˆ˜ë£Œ, ìŠ¬ë¦¬í”¼ì§€, funding rateë¥¼ ê³ ë ¤í•œ ì •êµí•œ ê¸°íšŒ íƒì§€
- **ìˆ˜ë ´ ì¶”ì **: ì‹ í˜¸ ë°œìƒ í›„ ì‹¤ì œ ìˆ˜ë ´ ì—¬ë¶€ ì¶”ì  ë° ë¶„ì„
- **ë¹ ë¥¸ UI**: NiceGUI ê¸°ë°˜ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- **ë¡œì»¬ ìŠ¤í† ë¦¬ì§€**: DuckDB + Parquetë¡œ ë¹ ë¥´ê³  íš¨ìœ¨ì ì¸ ë°ì´í„° ê´€ë¦¬

## ê¸°ìˆ  ìŠ¤íƒ

- **Runtime**: Python 3.9+, asyncio
- **Web Framework**: FastAPI (API + WebSocket)
- **UI**: NiceGUI (Python-only, ì‹¤ì‹œê°„ UI)
- **Storage**: DuckDB (ì¿¼ë¦¬) + Parquet (ì¥ê¸° ì €ì¥)
- **Data Processing**: pandas, numpy
- **Exchange APIs**: ccxt (REST), websockets (WebSocket)

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
arb-engine/
â”œâ”€â”€ configs/              # YAML ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ exchanges.yaml    # ê±°ë˜ì†Œ ëª©ë¡, ì‹¬ë³¼, ì—”ë“œí¬ì¸íŠ¸
â”‚   â”œâ”€â”€ fees.yaml         # ê±°ë˜ ìˆ˜ìˆ˜ë£Œ
â”‚   â”œâ”€â”€ strategy.yaml     # íƒì§€ ì„ê³„ê°’, ì „ëµ íŒŒë¼ë¯¸í„°
â”‚   â””â”€â”€ storage.yaml      # ì €ì¥ì†Œ ì„¤ì •
â”œâ”€â”€ src/arb_engine/
â”‚   â”œâ”€â”€ domain/           # ë„ë©”ì¸ ëª¨ë¸ (Pydantic)
â”‚   â”‚   â”œâ”€â”€ models.py     # PriceTick, OrderbookL5, ArbSignal ë“±
â”‚   â”‚   â””â”€â”€ schema.py     # DuckDB í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ core/             # í•µì‹¬ ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ config.py     # ì„¤ì • ë¡œë”©
â”‚   â”‚   â”œâ”€â”€ types.py      # íƒ€ì… ì •ì˜
â”‚   â”‚   â”œâ”€â”€ errors.py     # ì˜ˆì™¸ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ clock.py      # ì‹œê°„ ë™ê¸°í™”
â”‚   â”‚   â””â”€â”€ logging.py    # êµ¬ì¡°í™” ë¡œê¹…
â”‚   â”œâ”€â”€ adapters/         # ê±°ë˜ì†Œ ì–´ëŒ‘í„°
â”‚   â”‚   â”œâ”€â”€ common/       # Base adapter, symbol mapper
â”‚   â”‚   â”œâ”€â”€ cex/          # Binance, Bybit, OKX
â”‚   â”‚   â””â”€â”€ perps/        # Hyperliquid, Lighter
â”‚   â”œâ”€â”€ services/         # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ collector.py  # ë°ì´í„° ìˆ˜ì§‘ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”‚   â”‚   â”œâ”€â”€ normalizer.py # ë°ì´í„° ì •ê·œí™”
â”‚   â”‚   â”œâ”€â”€ storage.py    # ì €ì¥ì†Œ ì„œë¹„ìŠ¤
â”‚   â”‚   â”œâ”€â”€ arb_detector.py  # ì•„ë¹„íŠ¸ë¼ì§€ íƒì§€
â”‚   â”‚   â”œâ”€â”€ convergence.py   # ìˆ˜ë ´ ì¶”ì 
â”‚   â”‚   â”œâ”€â”€ simulator.py     # ë°±í…ŒìŠ¤íŠ¸/ì‹œë®¬ë ˆì´ì…˜
â”‚   â”‚   â””â”€â”€ reporting.py     # ë¦¬í¬íŠ¸ ìƒì„±
â”‚   â”œâ”€â”€ storage/          # ì €ì¥ì†Œ êµ¬í˜„
â”‚   â”‚   â”œâ”€â”€ duckdb.py     # DuckDB ì—°ê²°/ì¿¼ë¦¬
â”‚   â”‚   â””â”€â”€ writers.py    # Parquet ì‘ì„±
â”‚   â”œâ”€â”€ api/              # FastAPI ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ routes/       # REST API
â”‚   â”‚   â””â”€â”€ ws/           # WebSocket ìŠ¤íŠ¸ë¦¼
â”‚   â”œâ”€â”€ ui/               # NiceGUI ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”œâ”€â”€ dashboard.py  # ë©”ì¸ UI
â”‚   â”‚   â””â”€â”€ components/   # UI ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ app/              # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”‚       â”œâ”€â”€ main.py       # FastAPI ì•±
â”‚       â””â”€â”€ lifecycle.py  # ì‹œì‘/ì¢…ë£Œ í›…
â”œâ”€â”€ data/                 # ë°ì´í„° ì €ì¥
â”‚   â”œâ”€â”€ duckdb/           # DuckDB íŒŒì¼
â”‚   â””â”€â”€ parquet/          # Parquet íŒŒí‹°ì…˜
â””â”€â”€ scripts/              # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
    â”œâ”€â”€ run_collector.py  # ë°ì´í„° ìˆ˜ì§‘ ì‹¤í–‰
    â”œâ”€â”€ run_report.py     # ë¦¬í¬íŠ¸ ìƒì„±
    â””â”€â”€ run_simulation.py # ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
```

## ì„¤ì¹˜

### 1. ì €ì¥ì†Œ í´ë¡  ë° ì˜ì¡´ì„± ì„¤ì¹˜

```bash
cd /path/to/arb-engine

# ê°€ìƒí™˜ê²½ ìƒì„± (ê¶Œì¥)
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -e .

# ê°œë°œ ë„êµ¬ ì„¤ì¹˜ (ì„ íƒ)
pip install -e ".[dev]"
```

### 2. í™˜ê²½ ì„¤ì •

```bash
# .env íŒŒì¼ í¸ì§‘ (API í‚¤ ì…ë ¥)
cp .env.example .env
# í¸ì§‘ê¸°ë¡œ .env ì—´ì–´ì„œ API í‚¤ ì…ë ¥
nano .env
```

### 3. ë°ì´í„° ë””ë ‰í† ë¦¬ ì´ˆê¸°í™”

```bash
mkdir -p data/duckdb data/parquet data/raw
```

## ì‚¬ìš©ë²•

### Phase 0: ë°ì´í„° ìˆ˜ì§‘ (í˜„ì¬ êµ¬í˜„ ì¤‘)

```bash
# ë°ì´í„° ìˆ˜ì§‘ê¸° ì‹¤í–‰
python -m arb_engine.scripts.run_collector

# ë˜ëŠ”
arb-collector
```

### Phase 1: ì•„ë¹„íŠ¸ë¼ì§€ íƒì§€

```bash
# ì•„ë¹„íŠ¸ë¼ì§€ íƒì§€ + ìˆ˜ë ´ ì¶”ì 
# (êµ¬í˜„ ì˜ˆì •)
```

### Phase 2: ë¦¬í¬íŠ¸ ë° ì‹œë®¬ë ˆì´ì…˜

```bash
# í•˜ë£¨ ë¦¬í¬íŠ¸ ìƒì„±
python -m arb_engine.scripts.run_report

# ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
python -m arb_engine.scripts.run_simulation
```

## ê°œë°œ ë¡œë“œë§µ

### âœ… Phase 0: í”„ë¡œì íŠ¸ ì„¤ì • ë° ê¸°ë³¸ êµ¬ì¡°
- [x] í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
- [x] ì„¤ì • íŒŒì¼ (exchanges.yaml, fees.yaml, strategy.yaml, storage.yaml)
- [x] ë„ë©”ì¸ ëª¨ë¸ (models.py, schema.py)
- [x] Core ìœ í‹¸ë¦¬í‹° (config, types, errors, clock, logging)
- [x] Adapter ê¸°ë³¸ êµ¬ì¡° (BaseAdapter, SymbolMapper)
- [x] CEX adapters (Binance, Bybit, OKX)
- [ ] **PerpDEX adapters (Hyperliquid, Lighter)** â† ë‹¤ìŒ ì‘ì—…
- [ ] Storage êµ¬í˜„ (DuckDB writer, reader)
- [ ] Collector ì„œë¹„ìŠ¤
- [ ] ê¸°ë³¸ ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸

### ğŸš§ Phase 1: ì•„ë¹„íŠ¸ë¼ì§€ íƒì§€ ë° ìˆ˜ë ´ ì¶”ì 
- [ ] Normalizer ì„œë¹„ìŠ¤
- [ ] Fee ì„œë¹„ìŠ¤
- [ ] Arb Detector (íƒì§€ ë¡œì§)
- [ ] Convergence Tracker
- [ ] íƒì§€ ê²°ê³¼ ì €ì¥

### ğŸ“‹ Phase 2: ë¦¬í¬íŠ¸ ë° ì‹œë®¬ë ˆì´ì…˜
- [ ] Reporting ì„œë¹„ìŠ¤
- [ ] Simulator (ë°±í…ŒìŠ¤íŠ¸)
- [ ] í†µê³„ ë¶„ì„
- [ ] UI ëŒ€ì‹œë³´ë“œ
- [ ] API ì—”ë“œí¬ì¸íŠ¸

### ğŸš€ Phase 3: í”„ë¡œë•ì…˜ ì¤€ë¹„
- [ ] ì‹¤ê±°ë˜ executor (dry-run)
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
- [ ] ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] ë¬¸ì„œí™”

## ì„¤ì • íŒŒì¼ ì„¤ëª…

### exchanges.yaml
ê±°ë˜ì†Œë³„ WebSocket/REST ì—”ë“œí¬ì¸íŠ¸, ìˆ˜ì§‘í•  ì‹¬ë³¼, ìˆ˜ì§‘ ì£¼ê¸° ì •ì˜

### fees.yaml
ê±°ë˜ì†Œë³„ maker/taker fee, withdrawal fee ì •ì˜

### strategy.yaml
- ì•„ë¹„íŠ¸ë¼ì§€ íƒì§€ ì„ê³„ê°’ (minimum spread, slippage)
- í¬ì§€ì…˜ ì‚¬ì´ì§• ê·œì¹™
- ìˆ˜ë ´ ì¶”ì  íŒŒë¼ë¯¸í„°
- Funding rate ê³ ë ¤ ì—¬ë¶€

### storage.yaml
- DuckDB ì„¤ì • (ê²½ë¡œ, ì„±ëŠ¥ íŠœë‹)
- Parquet íŒŒí‹°ì…”ë‹ ì „ëµ
- ë°ì´í„° ë³´ê´€ ê¸°ê°„ (retention)
- ìë™ ì •ë¦¬ ì„¤ì •

## ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ê±°ë˜ì†Œ (CEX + PerpDEX)                â”‚
â”‚  Binance, Bybit, OKX, Hyperliquid, Lighter  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ WebSocket
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Adapters (ê±°ë˜ì†Œë³„)                 â”‚
â”‚  - ì—°ê²° ê´€ë¦¬, ì¬ì—°ê²°                           â”‚
â”‚  - ë©”ì‹œì§€ íŒŒì‹±                                 â”‚
â”‚  - ìµœì‹  ë°ì´í„° ìºì‹œ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ì›ì²œ ë°ì´í„°
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Collector (ìˆ˜ì§‘ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜)         â”‚
â”‚  - 1ì´ˆ ìŠ¤ëƒ…ìƒ· ì •ì±… ê°•ì œ                        â”‚
â”‚  - ì—¬ëŸ¬ adapter ê´€ë¦¬                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Normalizer (ì •ê·œí™”)               â”‚
â”‚  - ì‹¬ë³¼ í‘œì¤€í™”                                â”‚
â”‚  - Timestamp ì •ê·œí™”                          â”‚
â”‚  - PriceTick, OrderbookL5, FundingRate       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
            â”‚           â”‚
            â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Storage   â”‚  â”‚ Arb Detector â”‚
    â”‚  (DuckDB/  â”‚  â”‚              â”‚
    â”‚  Parquet)  â”‚  â”‚ - ê¸°íšŒ íƒì§€   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - ìˆ˜ë ´ ì¶”ì    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Simulator  â”‚
                    â”‚   Reporting  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   UI / API   â”‚
                    â”‚  (NiceGUI/   â”‚
                    â”‚   FastAPI)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë°ì´í„° ëª¨ë¸

### PriceTick
- exchange, symbol, price, volume_24h
- exchange_timestamp, received_timestamp

### OrderbookL5
- exchange, symbol
- bids[5], asks[5] (price, size)
- best_bid, best_ask, mid_price, spread

### FundingRate
- exchange, symbol, funding_rate
- next_funding_time, predicted_rate

### ArbSignal
- buy_exchange, sell_exchange
- buy_price, sell_price
- gross_spread, net_spread (after fees)
- estimated_size, estimated_slippage
- status (detected, in_progress, converged, failed)

## ê¸°ì—¬

ì´ í”„ë¡œì íŠ¸ëŠ” ê°œì¸ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## ë¼ì´ì„ ìŠ¤

MIT License

## ì°¸ê³ 

- Binance API: https://binance-docs.github.io/apidocs/
- Bybit API: https://bybit-exchange.github.io/docs/
- OKX API: https://www.okx.com/docs-v5/
- Hyperliquid API: https://hyperliquid.gitbook.io/
- Lighter: https://lighter.xyz/docs
